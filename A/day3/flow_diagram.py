# -*- coding: utf-8 -*-
"""
Day 3 ç»ƒä¹ : Function Calling æµç¨‹å›¾è§£
é€šè¿‡å¯è§†åŒ–çš„æ–¹å¼ç†è§£ Function Calling çš„å®Œæ•´æµç¨‹
"""
import json

print("=" * 80)
print("ğŸ“ Day 3: Function Calling æµç¨‹å›¾è§£")
print("=" * 80)

# ==========================================
# åœºæ™¯: ç”¨æˆ·è¯¢é—®å¤©æ°”
# ==========================================

print("\n" + "=" * 80)
print("ğŸ“– åœºæ™¯: ç”¨æˆ·è¯¢é—® 'åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·?'")
print("=" * 80)

print("\nã€ç¬¬ 1 æ­¥ã€‘ç”¨æˆ·æé—®")
print("-" * 80)
user_question = "åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·?"
print(f"ğŸ‘¤ ç”¨æˆ·: {user_question}")

print("\nã€ç¬¬ 2 æ­¥ã€‘æ„å»ºå¯¹è¯å†å²")
print("-" * 80)
messages = [
    {
        "role": "system",
        "content": "ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹,å¯ä»¥å¸®åŠ©ç”¨æˆ·æŸ¥è¯¢å¤©æ°”ã€‚"
    },
    {
        "role": "user",
        "content": user_question
    }
]
print("âœ… å¯¹è¯å†å²:")
for i, msg in enumerate(messages, 1):
    print(f"  {i}. [{msg['role']}] {msg['content'][:50]}...")

print("\nã€ç¬¬ 3 æ­¥ã€‘å®šä¹‰å¯ç”¨å·¥å…·")
print("-" * 80)
tools = [
    {
        "type": "function",
        "function": {
            "name": "get_weather",
            "description": "è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”ä¿¡æ¯",
            "parameters": {
                "type": "object",
                "properties": {
                    "city": {
                        "type": "string",
                        "description": "åŸå¸‚åç§°"
                    }
                },
                "required": ["city"]
            }
        }
    }
]
print("âœ… å·¥å…·å®šä¹‰:")
print(json.dumps(tools[0], ensure_ascii=False, indent=2))

print("\nã€ç¬¬ 4 æ­¥ã€‘ç¬¬ä¸€æ¬¡è°ƒç”¨ AI")
print("-" * 80)
print("ğŸ“¤ å‘é€è¯·æ±‚:")
print("  - model: qwen/qwen3-vl-8b")
print("  - messages: [system, user]")
print("  - tools: [get_weather]")
print("  - tool_choice: auto")

print("\nğŸ¤– AI æ€è€ƒè¿‡ç¨‹ (æ¨¡æ‹Ÿ):")
print("  1. åˆ†æç”¨æˆ·é—®é¢˜: 'åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·?'")
print("  2. è¯†åˆ«å…³é”®è¯: 'åŒ—äº¬', 'å¤©æ°”'")
print("  3. æŸ¥çœ‹å¯ç”¨å·¥å…·: get_weather")
print("  4. åˆ¤æ–­: éœ€è¦è°ƒç”¨ get_weather å‡½æ•°")
print("  5. æå–å‚æ•°: city = 'åŒ—äº¬'")

print("\nğŸ“¥ AI è¿”å› (æ¨¡æ‹Ÿ):")
ai_response = {
    "role": "assistant",
    "content": None,
    "tool_calls": [
        {
            "id": "call_abc123",
            "type": "function",
            "function": {
                "name": "get_weather",
                "arguments": '{"city": "åŒ—äº¬"}'
            }
        }
    ]
}
print(json.dumps(ai_response, ensure_ascii=False, indent=2))

print("\nã€ç¬¬ 5 æ­¥ã€‘è§£æå‡½æ•°è°ƒç”¨")
print("-" * 80)
tool_call = ai_response["tool_calls"][0]
function_name = tool_call["function"]["name"]
arguments_str = tool_call["function"]["arguments"]
arguments = json.loads(arguments_str)

print(f"ğŸ“ å‡½æ•°å: {function_name}")
print(f"ğŸ“‹ å‚æ•° (å­—ç¬¦ä¸²): {arguments_str}")
print(f"ğŸ“‹ å‚æ•° (è§£æå): {arguments}")
print(f"ğŸ”‘ è°ƒç”¨ ID: {tool_call['id']}")

print("\nã€ç¬¬ 6 æ­¥ã€‘æ‰§è¡Œå‡½æ•°")
print("-" * 80)

def get_weather(city):
    """æ¨¡æ‹Ÿè·å–å¤©æ°”"""
    weather_data = {
        "åŒ—äº¬": {"weather": "æ™´å¤©", "temperature": "15Â°C", "humidity": "45%"}
    }
    return json.dumps(weather_data.get(city, {}), ensure_ascii=False)

print(f"âš™ï¸  è°ƒç”¨: get_weather(city='{arguments['city']}')")
function_result = get_weather(**arguments)
print(f"âœ… è¿”å›ç»“æœ: {function_result}")

print("\nã€ç¬¬ 7 æ­¥ã€‘å°†ç»“æœåŠ å…¥å¯¹è¯å†å²")
print("-" * 80)

# æ·»åŠ  AI çš„å‡½æ•°è°ƒç”¨æ¶ˆæ¯
messages.append(ai_response)

# æ·»åŠ å‡½æ•°æ‰§è¡Œç»“æœ
messages.append({
    "role": "tool",
    "tool_call_id": tool_call["id"],
    "name": function_name,
    "content": function_result
})

print("âœ… æ›´æ–°åçš„å¯¹è¯å†å²:")
for i, msg in enumerate(messages, 1):
    role = msg['role']
    if role == 'tool':
        print(f"  {i}. [tool] å‡½æ•° {msg['name']} è¿”å›: {msg['content'][:50]}...")
    elif role == 'assistant' and msg.get('tool_calls'):
        print(f"  {i}. [assistant] è°ƒç”¨å‡½æ•°: {msg['tool_calls'][0]['function']['name']}")
    else:
        content = msg.get('content', '')
        print(f"  {i}. [{role}] {content[:50]}...")

print("\nã€ç¬¬ 8 æ­¥ã€‘ç¬¬äºŒæ¬¡è°ƒç”¨ AI")
print("-" * 80)
print("ğŸ“¤ å‘é€è¯·æ±‚:")
print("  - model: qwen/qwen3-vl-8b")
print("  - messages: [system, user, assistant(tool_call), tool(result)]")
print("  - tools: (ä¸éœ€è¦äº†)")

print("\nğŸ¤– AI æ€è€ƒè¿‡ç¨‹ (æ¨¡æ‹Ÿ):")
print("  1. çœ‹åˆ°å‡½æ•°è¿”å›ç»“æœ: {\"weather\": \"æ™´å¤©\", \"temperature\": \"15Â°C\", ...}")
print("  2. ç†è§£æ•°æ®: åŒ—äº¬å¤©æ°”æ™´å¤©,æ¸©åº¦15åº¦")
print("  3. ç”Ÿæˆç”¨æˆ·å‹å¥½çš„å›å¤")

print("\nğŸ“¥ AI æœ€ç»ˆå›å¤ (æ¨¡æ‹Ÿ):")
final_response = {
    "role": "assistant",
    "content": "åŒ—äº¬ä»Šå¤©å¤©æ°”æ™´å¤©,æ°”æ¸©15Â°C,æ¹¿åº¦45%ã€‚å»ºè®®å¤–å‡ºæ—¶æ³¨æ„é˜²æ™’,ç©¿ç€èˆ’é€‚ä¿æš–çš„è¡£ç‰©å“¦!"
}
print(f"ğŸ’¬ {final_response['content']}")

# ==========================================
# æµç¨‹å›¾æ€»ç»“
# ==========================================

print("\n" + "=" * 80)
print("ğŸ“Š å®Œæ•´æµç¨‹å›¾")
print("=" * 80)

flow_chart = """
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ç”¨æˆ·æé—®: "åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·?"                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. æ„å»ºå¯¹è¯å†å²                                                     â”‚
â”‚     messages = [                                                    â”‚
â”‚       {role: "system", content: "ä½ æ˜¯æ™ºèƒ½åŠ©æ‰‹..."},                 â”‚
â”‚       {role: "user", content: "åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·?"}                â”‚
â”‚     ]                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. ç¬¬ä¸€æ¬¡è°ƒç”¨ AI                                                    â”‚
â”‚     client.chat.completions.create(                                 â”‚
â”‚       messages=messages,                                            â”‚
â”‚       tools=[get_weather],                                          â”‚
â”‚       tool_choice="auto"                                            â”‚
â”‚     )                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. AI åˆ†æå¹¶è¿”å›å‡½æ•°è°ƒç”¨                                            â”‚
â”‚     {                                                               â”‚
â”‚       "tool_calls": [{                                              â”‚
â”‚         "function": {                                               â”‚
â”‚           "name": "get_weather",                                    â”‚
â”‚           "arguments": '{"city": "åŒ—äº¬"}'                           â”‚
â”‚         }                                                           â”‚
â”‚       }]                                                            â”‚
â”‚     }                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. è§£æå¹¶æ‰§è¡Œå‡½æ•°                                                   â”‚
â”‚     args = json.loads('{"city": "åŒ—äº¬"}')                           â”‚
â”‚     result = get_weather(**args)                                    â”‚
â”‚     # è¿”å›: {"weather": "æ™´å¤©", "temperature": "15Â°C"}              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. å°†ç»“æœåŠ å…¥å¯¹è¯å†å²                                               â”‚
â”‚     messages.append({                                               â”‚
â”‚       role: "tool",                                                 â”‚
â”‚       content: '{"weather": "æ™´å¤©", ...}'                           â”‚
â”‚     })                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. ç¬¬äºŒæ¬¡è°ƒç”¨ AI                                                    â”‚
â”‚     client.chat.completions.create(                                 â”‚
â”‚       messages=messages  # åŒ…å«å‡½æ•°ç»“æœ                             â”‚
â”‚     )                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  8. AI ç”Ÿæˆæœ€ç»ˆå›å¤                                                  â”‚
â”‚     "åŒ—äº¬ä»Šå¤©å¤©æ°”æ™´å¤©,æ°”æ¸©15Â°C,æ¹¿åº¦45%ã€‚å»ºè®®å¤–å‡ºæ—¶æ³¨æ„é˜²æ™’..."      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
"""

print(flow_chart)

# ==========================================
# å…³é”®ç‚¹æ€»ç»“
# ==========================================

print("\n" + "=" * 80)
print("ğŸ”‘ å…³é”®ç‚¹æ€»ç»“")
print("=" * 80)

key_points = """
1. **ä¸¤è½®å¯¹è¯**
   - ç¬¬ä¸€è½®: AI å†³å®šè°ƒç”¨å‡½æ•°
   - ç¬¬äºŒè½®: AI æ ¹æ®å‡½æ•°ç»“æœç”Ÿæˆå›å¤

2. **AI ä¸ç›´æ¥æ‰§è¡Œ**
   - AI åªè¿”å›å‡½æ•°è°ƒç”¨æŒ‡ä»¤
   - ä½ çš„ä»£ç è´Ÿè´£æ‰§è¡Œ
   - ä¿è¯å®‰å…¨æ€§å’Œæ§åˆ¶æƒ

3. **å‚æ•°æ˜¯ JSON å­—ç¬¦ä¸²**
   - arguments æ˜¯å­—ç¬¦ä¸²,éœ€è¦ json.loads() è§£æ
   - è§£æåæ‰èƒ½ä¼ ç»™å‡½æ•°

4. **å¯¹è¯å†å²å¾ˆé‡è¦**
   - å¿…é¡»å°†å‡½æ•°è°ƒç”¨å’Œç»“æœéƒ½åŠ å…¥ messages
   - AI éœ€è¦çœ‹åˆ°å®Œæ•´çš„ä¸Šä¸‹æ–‡

5. **tool_call_id ç”¨äºå…³è”**
   - æ¯ä¸ªå‡½æ•°è°ƒç”¨æœ‰å”¯ä¸€ ID
   - è¿”å›ç»“æœæ—¶è¦å¸¦ä¸Šè¿™ä¸ª ID
"""

print(key_points)

print("=" * 80)
print("ğŸ‰ æµç¨‹å›¾è§£å®Œæˆ!")
print("=" * 80)
