# Day 4: MCP åè®®å…¥é—¨ (Server ç«¯)

## ğŸ¯ ç›®æ ‡
ä½¿ç”¨ `fastmcp` ç¼–å†™ä¸€ä¸ªèƒ½è¯»å–æœ¬åœ°æ–‡ä»¶å¤¹(åˆ—å‡ºæ–‡ä»¶ã€è¯»å–å†…å®¹)çš„ç®€æ˜“ MCP æœåŠ¡å™¨,å¹¶åœ¨ç»ˆç«¯æµ‹è¯•å®ƒã€‚

## ğŸ¤” ä»€ä¹ˆæ˜¯ MCP?

### MCP = Model Context Protocol (æ¨¡å‹ä¸Šä¸‹æ–‡åè®®)

**ç®€å•ç†è§£:**
MCP æ˜¯ä¸€ä¸ª**æ ‡å‡†åŒ–åè®®**,ç”¨äºè®© AI ä¸å¤–éƒ¨å·¥å…·é€šä¿¡ã€‚

**ç±»æ¯”:**
- **Day 3 çš„æ–¹å¼**: ä½ æ‰‹åŠ¨å®šä¹‰æ¯ä¸ªå‡½æ•°,æ‰‹åŠ¨è§£æå‚æ•°,æ‰‹åŠ¨æ‰§è¡Œ
- **MCP çš„æ–¹å¼**: ä½¿ç”¨æ ‡å‡†åè®®,è‡ªåŠ¨å¤„ç†é€šä¿¡,å·¥å…·å¯å¤ç”¨

---

## ğŸ’¡ ä¸ºä»€ä¹ˆéœ€è¦ MCP?

### Day 3 çš„é—®é¢˜

åœ¨ Day 3 ä¸­,æˆ‘ä»¬æ‰‹åŠ¨å®ç°äº† Function Calling:

```python
# æ‰‹åŠ¨å®šä¹‰å·¥å…·
tools = [{
    "type": "function",
    "function": {
        "name": "get_weather",
        "description": "...",
        "parameters": {...}
    }
}]

# æ‰‹åŠ¨æ‰§è¡Œå‡½æ•°
if function_name == "get_weather":
    result = get_weather(**args)
```

**é—®é¢˜:**
- âŒ æ¯ä¸ªé¡¹ç›®éƒ½è¦é‡å†™è¿™äº›ä»£ç 
- âŒ å·¥å…·å®šä¹‰æ ¼å¼ä¸ç»Ÿä¸€
- âŒ éš¾ä»¥åœ¨ä¸åŒé¡¹ç›®é—´å¤ç”¨
- âŒ æ²¡æœ‰æ ‡å‡†çš„é”™è¯¯å¤„ç†

### MCP çš„è§£å†³æ–¹æ¡ˆ

```python
from fastmcp import FastMCP

mcp = FastMCP("æ–‡ä»¶ç®¡ç†å™¨")

@mcp.tool()
def list_files(directory: str) -> str:
    """åˆ—å‡ºç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶"""
    # å®ç°é€»è¾‘
    ...

# MCP è‡ªåŠ¨å¤„ç†:
# - å·¥å…·æ³¨å†Œ
# - å‚æ•°è§£æ
# - é”™è¯¯å¤„ç†
# - é€šä¿¡åè®®
```

**ä¼˜åŠ¿:**
- âœ… æ ‡å‡†åŒ–çš„æ¥å£
- âœ… è‡ªåŠ¨ç”Ÿæˆå·¥å…·æè¿°
- âœ… å·¥å…·å¯å¤ç”¨
- âœ… ç»Ÿä¸€çš„é”™è¯¯å¤„ç†

---

## ğŸ“ æ ¸å¿ƒæ¦‚å¿µ

### 1. MCP Server (æœåŠ¡ç«¯)

**ä½œç”¨:** æä¾›å·¥å…·(Tools)ç»™ AI ä½¿ç”¨ã€‚

**ç»„æˆ:**
- **Tools (å·¥å…·)**: å¯ä»¥è¢«è°ƒç”¨çš„å‡½æ•°
- **Resources (èµ„æº)**: å¯ä»¥è¢«è¯»å–çš„æ•°æ®
- **Prompts (æç¤ºè¯)**: é¢„å®šä¹‰çš„æç¤ºè¯æ¨¡æ¿

**ä»Šå¤©é‡ç‚¹:** Tools

### 2. MCP Client (å®¢æˆ·ç«¯)

**ä½œç”¨:** è¿æ¥åˆ° MCP Server,è®© AI è°ƒç”¨æœåŠ¡å™¨ä¸Šçš„å·¥å…·ã€‚

**Day 4 é‡ç‚¹:** Server ç«¯
**Day 5 é‡ç‚¹:** Client ç«¯

### 3. FastMCP

**ä½œç”¨:** ä¸€ä¸ª Python åº“,è®©åˆ›å»º MCP Server å˜å¾—ç®€å•ã€‚

**å®‰è£…:**
```bash
pip install fastmcp
```

---

## ğŸ—ï¸ MCP æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚         â”‚             â”‚         â”‚             â”‚
â”‚   AI/LLM    â”‚ â—„â”€â”€â”€â”€â”€â–º â”‚ MCP Client  â”‚ â—„â”€â”€â”€â”€â”€â–º â”‚ MCP Server  â”‚
â”‚             â”‚         â”‚             â”‚         â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                                                       â”‚
                                                       â–¼
                                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                 â”‚   Tools     â”‚
                                                 â”‚  (å‡½æ•°)     â”‚
                                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æµç¨‹:**
1. AI å†³å®šè°ƒç”¨å·¥å…·
2. Client å°†è¯·æ±‚å‘é€ç»™ Server
3. Server æ‰§è¡Œå·¥å…·
4. Server è¿”å›ç»“æœç»™ Client
5. Client å°†ç»“æœè¿”å›ç»™ AI

---

## ğŸš€ ä»Šå¤©çš„ä»»åŠ¡

### ç›®æ ‡: åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ç®¡ç† MCP Server

**åŠŸèƒ½:**
1. `list_files(directory)` - åˆ—å‡ºç›®å½•ä¸­çš„æ–‡ä»¶
2. `read_file(filepath)` - è¯»å–æ–‡ä»¶å†…å®¹
3. `get_file_info(filepath)` - è·å–æ–‡ä»¶ä¿¡æ¯(å¤§å°ã€ä¿®æ”¹æ—¶é—´ç­‰)

### æµ‹è¯•æ–¹å¼

ä½¿ç”¨ `fastmcp` çš„å†…ç½®æµ‹è¯•å·¥å…·:
```bash
fastmcp dev file_server.py
```

è¿™ä¼šå¯åŠ¨ä¸€ä¸ªäº¤äº’å¼æµ‹è¯•ç¯å¢ƒ,è®©ä½ å¯ä»¥:
- æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å·¥å…·
- æµ‹è¯•å·¥å…·è°ƒç”¨
- æŸ¥çœ‹è¿”å›ç»“æœ

---

## ğŸ“– FastMCP åŸºç¡€è¯­æ³•

### 1. åˆ›å»º MCP å®ä¾‹

```python
from fastmcp import FastMCP

mcp = FastMCP("æœåŠ¡å™¨åç§°")
```

### 2. å®šä¹‰å·¥å…·

```python
@mcp.tool()
def å‡½æ•°å(å‚æ•°: ç±»å‹) -> è¿”å›ç±»å‹:
    """å‡½æ•°æè¿° - è¿™ä¼šè‡ªåŠ¨æˆä¸ºå·¥å…·çš„ description"""
    # å®ç°é€»è¾‘
    return ç»“æœ
```

**å…³é”®ç‚¹:**
- ä½¿ç”¨ `@mcp.tool()` è£…é¥°å™¨
- å¿…é¡»æœ‰ç±»å‹æ³¨è§£ (å‚æ•°å’Œè¿”å›å€¼)
- æ–‡æ¡£å­—ç¬¦ä¸²ä¼šæˆä¸ºå·¥å…·æè¿°

### 3. è¿è¡ŒæœåŠ¡å™¨

```python
if __name__ == "__main__":
    mcp.run()
```

---

## ğŸ”‘ å…³é”®ç‰¹æ€§

### è‡ªåŠ¨ç±»å‹è½¬æ¢

FastMCP ä¼šè‡ªåŠ¨:
- è§£æå‚æ•°ç±»å‹
- éªŒè¯å‚æ•°
- è½¬æ¢æ•°æ®ç±»å‹
- ç”Ÿæˆ JSON Schema

### è‡ªåŠ¨æ–‡æ¡£ç”Ÿæˆ

```python
@mcp.tool()
def add(a: int, b: int) -> int:
    """å°†ä¸¤ä¸ªæ•°å­—ç›¸åŠ """
    return a + b
```

è‡ªåŠ¨ç”Ÿæˆ:
```json
{
  "name": "add",
  "description": "å°†ä¸¤ä¸ªæ•°å­—ç›¸åŠ ",
  "parameters": {
    "type": "object",
    "properties": {
      "a": {"type": "integer"},
      "b": {"type": "integer"}
    },
    "required": ["a", "b"]
  }
}
```

### é”™è¯¯å¤„ç†

FastMCP è‡ªåŠ¨å¤„ç†:
- å‚æ•°éªŒè¯é”™è¯¯
- ç±»å‹è½¬æ¢é”™è¯¯
- å‡½æ•°æ‰§è¡Œé”™è¯¯

---

## ğŸ’¡ å®æˆ˜å»ºè®®

### 1. å®‰å…¨æ€§

è¯»å–æ–‡ä»¶æ—¶è¦éªŒè¯è·¯å¾„:
```python
import os

def read_file(filepath: str) -> str:
    # éªŒè¯è·¯å¾„å­˜åœ¨
    if not os.path.exists(filepath):
        raise FileNotFoundError(f"æ–‡ä»¶ä¸å­˜åœ¨: {filepath}")
    
    # é˜²æ­¢è·¯å¾„éå†æ”»å‡»
    filepath = os.path.abspath(filepath)
    
    # è¯»å–æ–‡ä»¶
    with open(filepath, 'r') as f:
        return f.read()
```

### 2. é”™è¯¯ä¿¡æ¯

è¿”å›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯:
```python
try:
    # æ“ä½œ
    ...
except Exception as e:
    raise Exception(f"æ“ä½œå¤±è´¥: {str(e)}")
```

### 3. æ–‡æ¡£å­—ç¬¦ä¸²

å†™æ¸…æ™°çš„æ–‡æ¡£:
```python
@mcp.tool()
def list_files(directory: str) -> list[str]:
    """
    åˆ—å‡ºæŒ‡å®šç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•
    
    Args:
        directory: ç›®å½•è·¯å¾„,ä¾‹å¦‚: /home/user/documents
    
    Returns:
        æ–‡ä»¶å’Œç›®å½•åç§°åˆ—è¡¨
    """
    ...
```

---

## ğŸ“ å­¦ä¹ è·¯å¾„

### ä»Šå¤© (Day 4)
1. ç†è§£ MCP çš„ä½œç”¨
2. å­¦ä¹  FastMCP åŸºç¡€è¯­æ³•
3. åˆ›å»ºæ–‡ä»¶ç®¡ç† Server
4. ä½¿ç”¨ `fastmcp dev` æµ‹è¯•

### æ˜å¤© (Day 5)
1. åˆ›å»º MCP Client
2. è¿æ¥ Server å’Œ Client
3. è®© AI é€šè¿‡ Client è°ƒç”¨ Server çš„å·¥å…·
4. å®ç°å®Œæ•´çš„ Agent å¾ªç¯

---

ç°åœ¨æ‰“å¼€ `file_server.py` å¼€å§‹ç¼–ç¨‹!
